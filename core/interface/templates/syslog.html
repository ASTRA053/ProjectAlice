{% extends 'base.html' %}

{% block header %}
	{% block title %}Syslog{% endblock %}
{% endblock %}

{% block content %}
	<script src="{{ url_for('static', filename='jquery-3.4.1.min.js') }}"></script>
	<script type=text/javascript>
		let $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
		function getLogColor(line) {
		    if (line.includes('[INFO]')) {
		        return 'logInfo'
			}
		    else if (line.includes('[WARNING]')) {
		        return 'logWarning'
			}
		    else if (line.includes('[ERROR]')) {
		        return 'logError'
			}
		    else {
		        return 'logInfo'
			}
		}
		function refreshData() {
		    $.get(
				$SCRIPT_ROOT + '/syslog/update',
                function (data) {
                    for (let i = 0; i < data.data.length; i++) {
                        let console = $('#console');
                        console.append(
                            '<span class="logLine ' + getLogColor(data.data[i]) + '">' + data.data[i] + '</span>'
                        );
						console.scrollTop = console.scrollHeight;
                    }
                }
			)
		}
		$(document).ready(
		    function() {
		        $.get(
					$SCRIPT_ROOT + '/syslog/refresh',
					function (data) {
						for (let i = 0; i < data.data.length; i++) {
							let console = $('#console');
							console.append(
								'<span class="logLine ' + getLogColor(data.data[i]) + '">' + data.data[i] + '</span>'
							);
							console.scrollTop = console.scrollHeight;
						}
					}
				);
				setInterval(function() {
				    refreshData()
				}, 500)
			}
		)
	</script>
	<div class="console" id="console">
	</div>
{% endblock %}